<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Video Learning Platform</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
    }
    
    html {
      height: 100%;
    }
    
    .video-container {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      overflow: hidden;
    }
    
    .video-container iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
    }

    .gradient-bg {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .card-hover {
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 40px rgba(0,0,0,0.3);
    }

    .spinner {
      border: 3px solid rgba(255,255,255,0.3);
      border-radius: 50%;
      border-top: 3px solid white;
      width: 20px;
      height: 20px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 16px 24px;
      border-radius: 8px;
      color: white;
      font-weight: 600;
      z-index: 1000;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body>
  <div id="app" class="min-h-full flex flex-col"><!-- Login Screen -->
   <div id="login-screen" class="min-h-full flex items-center justify-center p-6 gradient-bg">
    <div id="login-box" class="rounded-2xl shadow-2xl p-8 max-w-md w-full">
     <div class="text-center mb-8">
      <div class="text-6xl mb-4">
       üîê
      </div>
      <h2 id="login-title" class="font-bold mb-2">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <p id="login-subtitle" class="opacity-70">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</p>
     </div>
     <form id="login-form" class="space-y-4">
      <div><label for="email" id="label-email" class="block font-semibold mb-2 text-sm">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="email" placeholder="your@email.com" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:ring-2 text-sm" required>
      </div>
      <div><label for="password" id="label-password" class="block font-semibold mb-2 text-sm">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:ring-2 text-sm" required>
      </div><button type="submit" id="btn-login" class="w-full py-3 rounded-lg font-bold transition-all duration-200 hover:scale-105 shadow-lg flex items-center justify-center gap-2"> <span id="login-text">üîì ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span>
       <div id="login-spinner" class="spinner hidden"></div></button>
      <div id="login-error" class="text-center text-sm font-semibold hidden" style="color: #ef4444;">
       ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
      </div>
      <div class="text-center"><button type="button" id="btn-toggle-register" class="text-sm font-semibold hover:underline"> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ? ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
      </div>
     </form>
     <form id="register-form" class="space-y-4 hidden">
      <div><label for="register-email" id="label-register-email" class="block font-semibold mb-2 text-sm">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="register-email" placeholder="your@email.com" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:ring-2 text-sm" required>
      </div>
      <div><label for="register-password" id="label-register-password" class="block font-semibold mb-2 text-sm">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£)</label> <input type="password" id="register-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:ring-2 text-sm" required minlength="6">
      </div>
      <div><label for="register-confirm" id="label-register-confirm" class="block font-semibold mb-2 text-sm">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="register-confirm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-2 rounded-lg border-2 focus:outline-none focus:ring-2 text-sm" required minlength="6">
      </div><button type="submit" id="btn-register" class="w-full py-3 rounded-lg font-bold transition-all duration-200 hover:scale-105 shadow-lg flex items-center justify-center gap-2"> <span id="register-text">‚ú® ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</span>
       <div id="register-spinner" class="spinner hidden"></div></button>
      <div id="register-error" class="text-center text-sm font-semibold hidden" style="color: #ef4444;">
       ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î
      </div>
      <div class="text-center"><button type="button" id="btn-toggle-login" class="text-sm font-semibold hover:underline"> ‡∏°‡∏µ‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡πâ‡∏ß? ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
      </div>
     </form>
    </div>
   </div><!-- Main App (Hidden until login) -->
   <div id="main-app" class="min-h-full flex flex-col hidden"><!-- Beautiful Header -->
    <header id="header" class="gradient-bg shadow-2xl">
     <div class="max-w-7xl mx-auto px-6 py-6"><!-- Top Bar with Logo and User -->
      <div class="flex justify-between items-center mb-8"><!-- Logo Section -->
       <div class="flex items-center gap-4">
        <div class="w-16 h-16 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-3xl border-4 border-white border-opacity-30 shadow-lg">
         üëë
        </div>
        <div>
         <h1 id="site-title" class="font-bold text-white drop-shadow-lg" style="font-size: 2rem; letter-spacing: 2px;">THE ONE</h1>
         <p id="site-subtitle" class="text-white opacity-90 font-semibold">‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</p>
        </div>
       </div><!-- User Section -->
       <div class="flex items-center gap-3">
        <div class="text-right bg-white bg-opacity-10 backdrop-blur-sm px-4 py-2 rounded-lg border border-white border-opacity-20">
         <div id="user-email" class="text-sm font-semibold text-white"></div>
         <div class="text-xs text-white opacity-70">
          ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô
         </div>
        </div><button id="btn-logout" class="px-4 py-2 rounded-lg font-semibold transition-all duration-200 hover:scale-105 bg-white bg-opacity-20 backdrop-blur-sm text-white border-2 border-white border-opacity-30 text-sm hover:bg-opacity-30"> üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö </button>
       </div>
      </div><!-- Navigation -->
      <nav class="flex justify-center gap-3 flex-wrap mb-6"><button id="btn-home" class="nav-btn px-6 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105 active bg-white bg-opacity-20 backdrop-blur-sm text-white border-2 border-white border-opacity-30"> üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å </button> <button id="btn-video" class="nav-btn px-6 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105 bg-white bg-opacity-10 backdrop-blur-sm text-white border-2 border-white border-opacity-20"> üìπ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠ </button> <button id="btn-document" class="nav-btn px-6 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105 bg-white bg-opacity-10 backdrop-blur-sm text-white border-2 border-white border-opacity-20"> üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ </button> <button id="btn-mindmap" class="nav-btn px-6 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105 bg-white bg-opacity-10 backdrop-blur-sm text-white border-2 border-white border-opacity-20"> üó∫Ô∏è ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û </button> <button id="btn-quiz" class="nav-btn px-6 py-3 rounded-lg font-semibold transition-all duration-200 hover:scale-105 bg-white bg-opacity-10 backdrop-blur-sm text-white border-2 border-white border-opacity-20"> üìù ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö </button>
      </nav>
     </div>
    </header>
    <main class="flex-1 px-6 py-8">
     <div class="max-w-7xl mx-auto"><!-- Home Section -->
      <div id="section-home" class="content-section"><!-- Hero Banner -->
       <div class="rounded-2xl p-12 mb-8 text-center gradient-bg shadow-2xl">
        <div class="text-7xl mb-4">
         üëë
        </div>
        <h2 id="home-title" class="font-bold text-white mb-4" style="font-size: 2.5rem;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà THE ONE ‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</h2>
        <p id="home-subtitle" class="text-white text-xl opacity-90 mb-6">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</p>
        <div class="flex justify-center gap-4 flex-wrap"><button onclick="switchSection('video')" class="px-8 py-3 rounded-full font-bold bg-white text-purple-700 hover:scale-105 transition-transform shadow-lg"> üìπ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏•‡∏¢ </button> <button onclick="switchSection('quiz')" class="px-8 py-3 rounded-full font-bold bg-white bg-opacity-20 backdrop-blur-sm text-white border-2 border-white hover:scale-105 transition-transform"> üìù ‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö </button>
        </div>
       </div><!-- Featured Content Sections -->
       <div class="space-y-12"><!-- Featured Videos -->
        <div>
         <div class="flex justify-between items-center mb-6">
          <h3 id="featured-video-title" class="font-bold text-2xl">üìπ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><button onclick="switchSection('video')" id="view-all-videos" class="text-sm font-semibold hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</button>
         </div>
         <div id="home-video-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Featured videos will be loaded here -->
         </div>
        </div><!-- Featured Documents -->
        <div>
         <div class="flex justify-between items-center mb-6">
          <h3 id="featured-doc-title" class="font-bold text-2xl">üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><button onclick="switchSection('document')" id="view-all-docs" class="text-sm font-semibold hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</button>
         </div>
         <div id="home-document-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Featured documents will be loaded here -->
         </div>
        </div><!-- Featured Mindmaps -->
        <div>
         <div class="flex justify-between items-center mb-6">
          <h3 id="featured-mindmap-title" class="font-bold text-2xl">üó∫Ô∏è ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><button onclick="switchSection('mindmap')" id="view-all-mindmaps" class="text-sm font-semibold hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</button>
         </div>
         <div id="home-mindmap-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Featured mindmaps will be loaded here -->
         </div>
        </div><!-- Featured Quizzes -->
        <div>
         <div class="flex justify-between items-center mb-6">
          <h3 id="featured-quiz-title" class="font-bold text-2xl">üìù ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3><button onclick="switchSection('quiz')" id="view-all-quizzes" class="text-sm font-semibold hover:underline">‡∏î‡∏π‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Üí</button>
         </div>
         <div id="home-quiz-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Featured quizzes will be loaded here -->
         </div>
        </div>
       </div>
      </div><!-- Video Section -->
      <div id="section-video" class="content-section hidden">
       <div id="video-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Videos will be loaded here -->
       </div>
       <div id="video-empty" class="text-center py-16 hidden">
        <div class="text-6xl mb-4">
         üìπ
        </div>
        <p id="empty-video-text" class="text-xl font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
        <p id="empty-video-desc" class="opacity-70">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
       </div>
      </div><!-- Document Section -->
      <div id="section-document" class="content-section hidden">
       <div id="document-list" class="grid grid-cols-1 md:grid-cols-2 gap-6"><!-- Documents will be loaded here -->
       </div>
       <div id="document-empty" class="text-center py-16 hidden">
        <div class="text-6xl mb-4">
         üìÑ
        </div>
        <p id="empty-doc-text" class="text-xl font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
        <p id="empty-doc-desc" class="opacity-70">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
       </div>
      </div><!-- Mindmap Section -->
      <div id="section-mindmap" class="content-section hidden">
       <div id="mindmap-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Mindmaps will be loaded here -->
       </div>
       <div id="mindmap-empty" class="text-center py-16 hidden">
        <div class="text-6xl mb-4">
         üó∫Ô∏è
        </div>
        <p id="empty-mindmap-text" class="text-xl font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û</p>
        <p id="empty-mindmap-desc" class="opacity-70">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
       </div>
      </div><!-- Quiz Section -->
      <div id="section-quiz" class="content-section hidden">
       <div id="quiz-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><!-- Quizzes will be loaded here -->
       </div>
       <div id="quiz-empty" class="text-center py-16 hidden">
        <div class="text-6xl mb-4">
         üìù
        </div>
        <p id="empty-quiz-text" class="text-xl font-semibold mb-2">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</p>
        <p id="empty-quiz-desc" class="opacity-70">‡∏Ñ‡∏•‡∏¥‡∏Å "‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
       </div>
      </div>
     </div>
    </main><!-- Admin Modal -->
    <div id="admin-modal" class="fixed inset-0 z-50 hidden">
     <div class="absolute inset-0 bg-black bg-opacity-60" id="modal-backdrop"></div>
     <div class="relative min-h-full flex items-center justify-center p-4">
      <div id="admin-panel" class="rounded-2xl shadow-2xl max-w-6xl w-full max-h-[90%] overflow-y-auto bg-white">
       <div class="p-8"><!-- Header -->
        <div class="flex justify-between items-center mb-8">
         <div class="flex items-center gap-4">
          <div class="w-14 h-14 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-3xl shadow-lg">
           ‚öôÔ∏è
          </div>
          <div>
           <h2 id="admin-title" class="font-bold text-3xl">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h2>
           <p id="admin-subtitle" class="text-sm opacity-70">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
          </div>
         </div><button id="btn-close-modal" class="w-12 h-12 rounded-full hover:bg-opacity-10 hover:bg-black transition-all flex items-center justify-center text-3xl hover:scale-110">√ó</button>
        </div><!-- Tab Navigation -->
        <div class="flex gap-2 mb-6 border-b-2 border-gray-200"><button id="tab-content" class="tab-btn px-6 py-3 font-semibold transition-all border-b-4 border-purple-500 text-purple-600"> üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ </button> <button id="tab-users" class="tab-btn px-6 py-3 font-semibold transition-all border-b-4 border-transparent text-gray-500 hover:text-purple-600"> üë• ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
        </div><!-- Content Management Tab -->
        <div id="content-tab" class="tab-content">
         <div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><!-- Left Column: Add Content Form -->
          <div>
           <div class="rounded-xl p-6 shadow-lg border-2 bg-gradient-to-br from-purple-50 to-pink-50" style="border-color: #e9d5ff;">
            <div class="flex items-center gap-3 mb-6">
             <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center text-xl shadow">
              ‚ûï
             </div>
             <h3 id="form-title" class="font-bold text-xl text-purple-900">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            </div>
            <form id="add-content-form" class="space-y-4">
             <div><label for="content-type" id="label-type" class="block font-semibold mb-2 text-sm flex items-center gap-2 text-purple-900"> <span>üìÇ</span> ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ </label> <select id="content-type" class="w-full px-4 py-3 rounded-lg border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm font-semibold shadow-sm bg-white text-gray-900"> <option value="video">üìπ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (YouTube / Google Drive)</option> <option value="document">üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</option> <option value="mindmap">üó∫Ô∏è ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ</option> <option value="quiz">üìù ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</option> </select>
             </div>
             <div><label for="content-title" id="label-title" class="block font-semibold mb-2 text-sm flex items-center gap-2 text-purple-900"> <span>‚úèÔ∏è</span> ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á </label> <input type="text" id="content-title" placeholder="‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏™‡∏ô‡πÉ‡∏à" class="w-full px-4 py-3 rounded-lg border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm shadow-sm bg-white text-gray-900" required>
             </div>
             <div><label for="content-description" id="label-desc" class="block font-semibold mb-2 text-sm flex items-center gap-2 text-purple-900"> <span>üìù</span> ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ </label> <textarea id="content-description" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤" rows="3" class="w-full px-4 py-3 rounded-lg border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm shadow-sm bg-white text-gray-900" required></textarea>
             </div>
             <div><label for="content-url" id="label-url" class="block font-semibold mb-2 text-sm flex items-center gap-2 text-purple-900"> <span>üîó</span> ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ </label> <input type="url" id="content-url" placeholder="https://..." class="w-full px-4 py-3 rounded-lg border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm shadow-sm bg-white text-gray-900" required>
              <p id="url-hint" class="text-xs mt-2 text-purple-700 flex items-center gap-1"><span>üí°</span> ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠: ‡πÉ‡∏™‡πà‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube ‡∏´‡∏£‡∏∑‡∏≠ Google Drive</p>
             </div>
             <div><label for="content-image" id="label-image" class="block font-semibold mb-2 text-sm flex items-center gap-2 text-purple-900"> <span>üñºÔ∏è</span> ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û <span class="text-xs text-purple-600">(‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</span> </label> <input type="url" id="content-image" placeholder="https://..." class="w-full px-4 py-3 rounded-lg border-2 border-purple-300 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm shadow-sm bg-white text-gray-900">
             </div><button type="submit" id="btn-submit" class="w-full py-4 rounded-lg font-bold transition-all duration-200 hover:scale-105 shadow-lg flex items-center justify-center gap-2 text-base bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:shadow-xl"> <span id="submit-text">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</span>
              <div id="submit-spinner" class="spinner hidden"></div></button>
            </form>
           </div>
          </div><!-- Right Column: Content List -->
          <div>
           <div class="rounded-xl p-6 shadow-lg border-2 bg-gradient-to-br from-blue-50 to-cyan-50" style="border-color: #dbeafe;">
            <div class="flex items-center justify-between mb-6">
             <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-xl shadow">
               üìã
              </div>
              <div>
               <h3 id="manage-title" class="font-bold text-xl text-blue-900">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</h3>
               <p id="content-count" class="text-xs text-blue-700">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
              </div>
             </div>
            </div>
            <div id="admin-content-list" class="space-y-3 max-h-[600px] overflow-y-auto pr-2"><!-- Content items will be loaded here -->
            </div>
            <div id="admin-empty" class="text-center py-16 hidden">
             <div class="text-6xl mb-4">
              üì≠
             </div>
             <p class="text-lg font-semibold text-blue-900">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤</p>
             <p class="text-sm mt-2 text-blue-700">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢!</p>
            </div>
           </div>
          </div>
         </div><!-- User Approval Tab -->
         <div id="users-tab" class="tab-content hidden">
          <div class="rounded-xl p-6 shadow-lg border-2 bg-gradient-to-br from-blue-50 to-cyan-50" style="border-color: #dbeafe;">
           <div class="flex items-center gap-3 mb-6">
            <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center text-xl shadow">
             üë•
            </div>
            <div>
             <h3 class="font-bold text-xl text-blue-900">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</h3>
             <p id="pending-count" class="text-xs text-blue-700">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 0 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p>
            </div>
           </div>
           <div id="pending-users-list" class="space-y-3 max-h-[600px] overflow-y-auto pr-2"><!-- Pending users will be loaded here -->
           </div>
           <div id="pending-empty" class="text-center py-16">
            <div class="text-6xl mb-4">
             ‚úÖ
            </div>
            <p class="text-lg font-semibold text-blue-900">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
            <p class="text-sm mt-2 text-blue-700">‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡∏õ‡∏£‡∏≤‡∏Å‡∏è‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</p>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div><!-- View Content Modal -->
     <div id="view-modal" class="fixed inset-0 z-50 hidden">
      <div class="modal-backdrop absolute inset-0" id="view-backdrop"></div>
      <div class="relative min-h-full flex items-center justify-center p-4">
       <div id="view-panel" class="rounded-2xl shadow-2xl max-w-5xl w-full max-h-[90%] overflow-y-auto">
        <div class="p-8">
         <div class="flex justify-between items-center mb-6">
          <h2 id="view-title" class="font-bold"></h2><button id="btn-close-view" class="text-3xl hover:scale-110 transition-transform">√ó</button>
         </div>
         <div id="view-content"></div>
        </div>
       </div>
      </div>
     </div><!-- Beautiful Footer -->
     <footer id="footer" class="gradient-bg mt-auto">
      <div class="max-w-7xl mx-auto px-6 py-12">
       <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8"><!-- About Section -->
        <div>
         <div class="flex items-center gap-3 mb-4">
          <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-2xl border-2 border-white border-opacity-30">
           üëë
          </div>
          <div>
           <h3 id="footer-title" class="font-bold text-white text-xl" style="letter-spacing: 1px;">THE ONE</h3>
           <p class="text-white text-sm opacity-90">‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</p>
          </div>
         </div>
         <p id="footer-desc" class="text-white opacity-80 text-sm leading-relaxed">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏Ñ‡∏£‡∏ö‡∏Ñ‡∏£‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢</p>
        </div><!-- Quick Links -->
        <div>
         <h4 id="footer-links-title" class="font-bold text-white mb-4 text-lg">‡πÄ‡∏°‡∏ô‡∏π‡∏î‡πà‡∏ß‡∏ô</h4>
         <ul class="space-y-2">
          <li><button onclick="switchSection('video')" class="text-white opacity-80 hover:opacity-100 transition-opacity text-sm hover:underline"> üìπ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ö‡∏ó‡πÄ‡∏£‡∏µ‡∏¢‡∏ô </button></li>
          <li><button onclick="switchSection('document')" class="text-white opacity-80 hover:opacity-100 transition-opacity text-sm hover:underline"> üìÑ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö </button></li>
          <li><button onclick="switchSection('mindmap')" class="text-white opacity-80 hover:opacity-100 transition-opacity text-sm hover:underline"> üó∫Ô∏è ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ </button></li>
         </ul>
        </div><!-- Contact Info -->
        <div>
         <h4 id="footer-contact-title" class="font-bold text-white mb-4 text-lg">‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤</h4>
         <ul class="space-y-3">
          <li class="flex items-center gap-2 text-white opacity-80 text-sm"><span>üìß</span> <span id="footer-email">info@theone-exam.com</span></li>
          <li class="flex items-center gap-2 text-white opacity-80 text-sm"><span>üì±</span> <span id="footer-phone">02-XXX-XXXX</span></li>
          <li class="flex items-center gap-2 text-white opacity-80 text-sm"><span>üåê</span> <span id="footer-website">www.theone-exam.com</span></li>
         </ul>
        </div>
       </div><!-- Bottom Bar -->
       <div class="border-t border-white border-opacity-20 pt-6">
        <div class="flex flex-col md:flex-row justify-between items-center gap-4">
         <p id="footer-copyright" class="text-white opacity-70 text-sm text-center md:text-left">¬© 2024 THE ONE ‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£. All rights reserved.</p>
         <div class="flex items-center gap-4"><button id="btn-admin" class="px-6 py-2 rounded-full font-semibold transition-all duration-200 hover:scale-105 shadow-lg bg-white bg-opacity-20 backdrop-blur-sm text-white border-2 border-white border-opacity-30 hover:bg-opacity-30 text-sm"> üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô </button>
          <div class="flex gap-2"><a href="#" class="w-10 h-10 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-opacity-30 transition-all hover:scale-110 border border-white border-opacity-30"> <span class="text-lg">üìò</span> </a> <a href="#" class="w-10 h-10 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-opacity-30 transition-all hover:scale-110 border border-white border-opacity-30"> <span class="text-lg">üì∑</span> </a> <a href="#" class="w-10 h-10 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-opacity-30 transition-all hover:scale-110 border border-white border-opacity-30"> <span class="text-lg">üê¶</span> </a> <a href="#" class="w-10 h-10 rounded-full bg-white bg-opacity-20 backdrop-blur-sm flex items-center justify-center text-white hover:bg-opacity-30 transition-all hover:scale-110 border border-white border-opacity-30"> <span class="text-lg">‚ñ∂Ô∏è</span> </a>
          </div>
         </div>
        </div>
       </div>
      </div>
     </footer>
    </div>
   </div>
   <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDht0H3DLh47FJREAzVkStw9BHkB2LI-3w",
      authDomain: "jasmin2569.firebaseapp.com",
      databaseURL: "https://jasmin2569-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "jasmin2569",
      storageBucket: "jasmin2569.firebasestorage.app",
      messagingSenderId: ". ",
      appId: "1:. :web:d7c2ffa7cf935bbc0195be"
    };

    // Initialize Firebase
    let db;
    let auth;
    let currentUser = null;
    
    try {
      firebase.initializeApp(firebaseConfig);
      db = firebase.firestore();
      auth = firebase.auth();
    } catch (error) {
      console.error('Firebase initialization error:', error);
    }

    const defaultConfig = {
      background_color: "#f8fafc",
      surface_color: "#ffffff",
      text_color: "#1e293b",
      primary_color: "#8b5cf6",
      secondary_color: "#64748b",
      font_family: "Inter",
      font_size: 16,
      site_title: "THE ONE",
      site_subtitle: "‡∏™‡∏≠‡∏ö‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£",
      footer_email: "info@theone-exam.com",
      footer_phone: "02-XXX-XXXX",
      footer_website: "www.theone-exam.com"
    };

    let allContent = [];
    let currentSection = 'home';
    let isLoggedIn = false;
    let unsubscribeFirestore = null;
    let unsubscribePendingUsers = null;
    let pendingUsers = [];

    // Login System
    async function handleLogin(email, password) {
      if (!auth || !db) {
        showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°', 'error');
        return false;
      }

      try {
        const userCredential = await auth.signInWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Check if user is approved
        const userDoc = await db.collection('approved-users').doc(user.uid).get();
        
        if (!userDoc.exists) {
          // Check if user is still pending
          const pendingDoc = await db.collection('pending-users').doc(user.uid).get();
          
          if (pendingDoc.exists && pendingDoc.data().status === 'pending') {
            await auth.signOut();
            document.getElementById('login-error').textContent = '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô';
            document.getElementById('login-error').classList.remove('hidden');
            return false;
          } else if (pendingDoc.exists && pendingDoc.data().status === 'rejected') {
            await auth.signOut();
            document.getElementById('login-error').textContent = '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ñ‡∏π‡∏Å‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò';
            document.getElementById('login-error').classList.remove('hidden');
            return false;
          } else {
            await auth.signOut();
            document.getElementById('login-error').textContent = '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
            document.getElementById('login-error').classList.remove('hidden');
            return false;
          }
        }
        
        return true;
      } catch (error) {
        console.error('Login error:', error);
        let errorMessage = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        
        if (error.code === 'auth/user-not-found') {
          errorMessage = '‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ';
        } else if (error.code === 'auth/wrong-password') {
          errorMessage = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        } else if (error.code === 'auth/invalid-email') {
          errorMessage = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        } else if (error.code === 'auth/too-many-requests') {
          errorMessage = '‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
        }
        
        document.getElementById('login-error').textContent = errorMessage;
        document.getElementById('login-error').classList.remove('hidden');
        return false;
      }
    }

    async function handleRegister(email, password, confirmPassword) {
      if (!auth || !db) {
        showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏°', 'error');
        return false;
      }

      if (password !== confirmPassword) {
        document.getElementById('register-error').textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô';
        document.getElementById('register-error').classList.remove('hidden');
        return false;
      }

      if (password.length < 6) {
        document.getElementById('register-error').textContent = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 6 ‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£';
        document.getElementById('register-error').classList.remove('hidden');
        return false;
      }

      try {
        // Create user account
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        
        // Add user to pending approval collection
        await db.collection('pending-users').doc(user.uid).set({
          email: email,
          status: 'pending',
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Sign out immediately - user must wait for approval
        await auth.signOut();
        
        showToast('‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'success');
        return true;
      } catch (error) {
        console.error('Register error:', error);
        let errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
        
        if (error.code === 'auth/email-already-in-use') {
          errorMessage = '‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
        } else if (error.code === 'auth/invalid-email') {
          errorMessage = '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á';
        } else if (error.code === 'auth/weak-password') {
          errorMessage = '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠';
        }
        
        document.getElementById('register-error').textContent = errorMessage;
        document.getElementById('register-error').classList.remove('hidden');
        return false;
      }
    }

    async function handleLogout() {
      if (!auth) return;
      
      try {
        await auth.signOut();
      } catch (error) {
        console.error('Logout error:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö', 'error');
      }
    }

    function showLoginScreen() {
      document.getElementById('main-app').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
    }

    function showMainApp(user) {
      currentUser = user;
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('main-app').classList.remove('hidden');
      document.getElementById('user-email').textContent = user.email;
      document.getElementById('login-form').reset();
      document.getElementById('register-form').reset();
    }

    async function onConfigChange(config) {
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const secondaryColor = config.secondary_color || defaultConfig.secondary_color;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';
      
      document.body.style.backgroundColor = backgroundColor;
      
      const siteTitle = document.getElementById('site-title');
      siteTitle.textContent = config.site_title || defaultConfig.site_title;
      siteTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
      siteTitle.style.fontSize = `${baseSize * 2.5}px`;
      
      const siteSubtitle = document.getElementById('site-subtitle');
      siteSubtitle.textContent = config.site_subtitle || defaultConfig.site_subtitle;
      siteSubtitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
      siteSubtitle.style.fontSize = `${baseSize * 1.1}px`;

      // Update footer content
      const footerEmail = document.getElementById('footer-email');
      if (footerEmail) {
        footerEmail.textContent = config.footer_email || defaultConfig.footer_email;
        footerEmail.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const footerPhone = document.getElementById('footer-phone');
      if (footerPhone) {
        footerPhone.textContent = config.footer_phone || defaultConfig.footer_phone;
        footerPhone.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const footerWebsite = document.getElementById('footer-website');
      if (footerWebsite) {
        footerWebsite.textContent = config.footer_website || defaultConfig.footer_website;
        footerWebsite.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      // Style all text elements
      // Style login screen
      const loginBox = document.getElementById('login-box');
      loginBox.style.backgroundColor = surfaceColor;

      const loginTitle = document.getElementById('login-title');
      loginTitle.style.color = textColor;
      loginTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
      loginTitle.style.fontSize = `${baseSize * 1.8}px`;

      const loginSubtitle = document.getElementById('login-subtitle');
      loginSubtitle.style.color = textColor;
      loginSubtitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
      loginSubtitle.style.fontSize = `${baseSize}px`;

      const labelEmail = document.getElementById('label-email');
      if (labelEmail) {
        labelEmail.style.color = textColor;
        labelEmail.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const labelPassword = document.getElementById('label-password');
      labelPassword.style.color = textColor;
      labelPassword.style.fontFamily = `${customFont}, ${baseFontStack}`;

      const labelRegisterEmail = document.getElementById('label-register-email');
      if (labelRegisterEmail) {
        labelRegisterEmail.style.color = textColor;
        labelRegisterEmail.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const labelRegisterPassword = document.getElementById('label-register-password');
      if (labelRegisterPassword) {
        labelRegisterPassword.style.color = textColor;
        labelRegisterPassword.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const labelRegisterConfirm = document.getElementById('label-register-confirm');
      if (labelRegisterConfirm) {
        labelRegisterConfirm.style.color = textColor;
        labelRegisterConfirm.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const btnLogin = document.getElementById('btn-login');
      btnLogin.style.backgroundColor = primaryColor;
      btnLogin.style.color = '#ffffff';
      btnLogin.style.fontFamily = `${customFont}, ${baseFontStack}`;
      btnLogin.style.fontSize = `${baseSize}px`;

      const btnRegister = document.getElementById('btn-register');
      if (btnRegister) {
        btnRegister.style.backgroundColor = primaryColor;
        btnRegister.style.color = '#ffffff';
        btnRegister.style.fontFamily = `${customFont}, ${baseFontStack}`;
        btnRegister.style.fontSize = `${baseSize}px`;
      }

      const btnToggleRegister = document.getElementById('btn-toggle-register');
      if (btnToggleRegister) {
        btnToggleRegister.style.color = primaryColor;
        btnToggleRegister.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const btnToggleLogin = document.getElementById('btn-toggle-login');
      if (btnToggleLogin) {
        btnToggleLogin.style.color = primaryColor;
        btnToggleLogin.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      const textElements = [
        'empty-video-text', 'empty-video-desc', 'empty-doc-text', 'empty-doc-desc',
        'empty-mindmap-text', 'empty-mindmap-desc', 'admin-title', 'label-type',
        'label-title', 'label-desc', 'label-url', 'url-hint', 'label-image',
        'submit-text', 'manage-title', 'view-title'
      ];
      
      textElements.forEach(id => {
        const el = document.getElementById(id);
        if (el) {
          el.style.color = textColor;
          el.style.fontFamily = `${customFont}, ${baseFontStack}`;
        }
      });

      // Style headings
      document.getElementById('admin-title').style.fontSize = `${baseSize * 1.8}px`;
      document.getElementById('manage-title').style.fontSize = `${baseSize * 1.3}px`;
      document.getElementById('empty-video-text').style.fontSize = `${baseSize * 1.3}px`;
      document.getElementById('empty-doc-text').style.fontSize = `${baseSize * 1.3}px`;
      document.getElementById('empty-mindmap-text').style.fontSize = `${baseSize * 1.3}px`;

      // Style panels
      document.getElementById('admin-panel').style.backgroundColor = surfaceColor;
      document.getElementById('view-panel').style.backgroundColor = surfaceColor;

      // Style form inputs
      const inputs = document.querySelectorAll('input, textarea, select');
      inputs.forEach(input => {
        input.style.backgroundColor = backgroundColor;
        input.style.color = textColor;
        input.style.borderColor = secondaryColor;
        input.style.fontFamily = `${customFont}, ${baseFontStack}`;
        input.style.fontSize = `${baseSize}px`;
      });

      // Style submit button
      const submitBtn = document.getElementById('btn-submit');
      submitBtn.style.backgroundColor = primaryColor;
      submitBtn.style.color = '#ffffff';
      submitBtn.style.fontFamily = `${customFont}, ${baseFontStack}`;
      submitBtn.style.fontSize = `${baseSize * 1.1}px`;

      // Re-render content with new styles
      renderContent();
    }

    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_color || defaultConfig.primary_color,
            set: (value) => {
              config.primary_color = value;
              window.elementSdk.setConfig({ primary_color: value });
            }
          },
          {
            get: () => config.secondary_color || defaultConfig.secondary_color,
            set: (value) => {
              config.secondary_color = value;
              window.elementSdk.setConfig({ secondary_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => config.font_family || defaultConfig.font_family,
          set: (value) => {
            config.font_family = value;
            window.elementSdk.setConfig({ font_family: value });
          }
        },
        fontSizeable: {
          get: () => config.font_size || defaultConfig.font_size,
          set: (value) => {
            config.font_size = value;
            window.elementSdk.setConfig({ font_size: value });
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      return new Map([
        ["site_title", config.site_title || defaultConfig.site_title],
        ["site_subtitle", config.site_subtitle || defaultConfig.site_subtitle],
        ["footer_email", config.footer_email || defaultConfig.footer_email],
        ["footer_phone", config.footer_phone || defaultConfig.footer_phone],
        ["footer_website", config.footer_website || defaultConfig.footer_website]
      ]);
    }

    // Firebase Functions
    function loadContentFromFirebase() {
      if (!db) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ', 'error');
        return;
      }

      // Real-time listener
      unsubscribeFirestore = db.collection('learning-content')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          allContent = [];
          snapshot.forEach((doc) => {
            allContent.push({
              firebaseId: doc.id,
              ...doc.data()
            });
          });
          renderContent();
          renderAdminList();
        }, (error) => {
          console.error('Error loading content:', error);
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
        });
    }

    function loadPendingUsers() {
      if (!db) return;

      unsubscribePendingUsers = db.collection('pending-users')
        .where('status', '==', 'pending')
        .orderBy('createdAt', 'desc')
        .onSnapshot((snapshot) => {
          pendingUsers = [];
          snapshot.forEach((doc) => {
            pendingUsers.push({
              uid: doc.id,
              ...doc.data()
            });
          });
          renderPendingUsers();
        }, (error) => {
          console.error('Error loading pending users:', error);
        });
    }

    function renderPendingUsers() {
      const pendingList = document.getElementById('pending-users-list');
      const pendingEmpty = document.getElementById('pending-empty');
      const pendingCount = document.getElementById('pending-count');

      if (pendingCount) {
        pendingCount.textContent = `‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${pendingUsers.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
      }

      if (pendingUsers.length === 0) {
        pendingList.innerHTML = '';
        pendingEmpty.classList.remove('hidden');
      } else {
        pendingEmpty.classList.add('hidden');
        pendingList.innerHTML = pendingUsers.map(user => {
          const createdDate = user.createdAt ? new Date(user.createdAt.toDate()).toLocaleDateString('th-TH', {
            year: 'numeric',
            month: 'long',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          }) : '‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà';

          return `
            <div class="rounded-xl p-4 shadow-md hover:shadow-lg transition-all border-2 bg-white" style="border-color: #dbeafe;">
              <div class="flex items-center justify-between gap-3">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">üë§</span>
                    <div class="flex-1">
                      <div class="font-bold text-sm text-blue-900">${user.email}</div>
                      <div class="text-xs text-gray-600 mt-1">‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠: ${createdDate}</div>
                    </div>
                  </div>
                </div>
                <div class="flex gap-2 flex-shrink-0">
                  <button onclick="approveUser('${user.uid}', '${user.email}')" class="px-4 py-2 rounded-lg text-xs font-bold hover:scale-110 transition-transform shadow-md hover:shadow-lg bg-gradient-to-r from-green-500 to-green-600 text-white">
                    ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                  </button>
                  <button onclick="rejectUser('${user.uid}')" class="px-4 py-2 rounded-lg text-xs font-bold hover:scale-110 transition-transform shadow-md hover:shadow-lg bg-gradient-to-r from-red-500 to-red-600 text-white">
                    ‚ùå ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò
                  </button>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    async function approveUser(uid, email) {
      if (!db) return;

      try {
        // Add to approved users
        await db.collection('approved-users').doc(uid).set({
          email: email,
          approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        // Update pending status
        await db.collection('pending-users').doc(uid).update({
          status: 'approved',
          approvedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        showToast('‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      } catch (error) {
        console.error('Error approving user:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'error');
      }
    }

    async function rejectUser(uid) {
      if (!db) return;

      try {
        // Update pending status to rejected
        await db.collection('pending-users').doc(uid).update({
          status: 'rejected',
          rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        showToast('‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÅ‡∏•‡πâ‡∏ß', 'success');
      } catch (error) {
        console.error('Error rejecting user:', error);
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò', 'error');
      }
    }

    window.approveUser = approveUser;
    window.rejectUser = rejectUser;

    async function addContentToFirebase(contentData) {
      if (!db) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ', 'error');
        return false;
      }

      try {
        await db.collection('learning-content').add({
          ...contentData,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        return true;
      } catch (error) {
        console.error('Error adding content:', error);
        return false;
      }
    }

    async function deleteContentFromFirebase(firebaseId) {
      if (!db) {
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Firebase ‡πÑ‡∏î‡πâ', 'error');
        return false;
      }

      try {
        await db.collection('learning-content').doc(firebaseId).delete();
        return true;
      } catch (error) {
        console.error('Error deleting content:', error);
        return false;
      }
    }

    // Data SDK Handler
    const dataHandler = {
      onDataChanged(data) {
        allContent = data;
        renderContent();
        renderAdminList();
      }
    };

    function getYouTubeEmbedUrl(url) {
      const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
      const match = url.match(regExp);
      return (match && match[2].length === 11) ? `https://www.youtube.com/embed/${match[2]}` : null;
    }

    function getGoogleDriveVideoEmbedUrl(url) {
      // Check if it's a Google Drive link
      if (url.includes('drive.google.com')) {
        // Extract file ID from various Google Drive URL formats
        let fileId = null;
        
        // Format: https://drive.google.com/file/d/FILE_ID/view
        const match1 = url.match(/\/file\/d\/([^/]+)/);
        if (match1) {
          fileId = match1[1];
        }
        
        // Format: https://drive.google.com/open?id=FILE_ID
        const match2 = url.match(/[?&]id=([^&]+)/);
        if (match2) {
          fileId = match2[1];
        }
        
        if (fileId) {
          return `https://drive.google.com/file/d/${fileId}/preview`;
        }
      }
      return null;
    }

    function getVideoThumbnail(url) {
      // YouTube thumbnail
      const youtubeEmbed = getYouTubeEmbedUrl(url);
      if (youtubeEmbed) {
        const videoId = youtubeEmbed.split('/').pop();
        return `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
      }
      
      // Google Drive - use generic video icon
      if (url.includes('drive.google.com')) {
        return null; // Will show icon instead
      }
      
      return null;
    }

    function renderContent() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';

      // Render home page featured content
      renderHomeContent(config, surfaceColor, textColor, primaryColor, customFont, baseSize, baseFontStack);

      // Render videos
      const videoList = document.getElementById('video-list');
      const videoEmpty = document.getElementById('video-empty');
      const videos = allContent.filter(item => item.type === 'video');
      
      if (videos.length === 0) {
        videoList.innerHTML = '';
        videoEmpty.classList.remove('hidden');
        videoEmpty.style.color = textColor;
      } else {
        videoEmpty.classList.add('hidden');
        videoList.innerHTML = videos.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          
          // Get video thumbnail
          let thumbnailUrl = item.imageUrl;
          if (!thumbnailUrl && item.url) {
            thumbnailUrl = getVideoThumbnail(item.url);
          }
          
          // Check if it's Google Drive video
          const isGoogleDrive = item.url.includes('drive.google.com');
          
          return `
            <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
              <div class="relative">
                ${thumbnailUrl ? `
                  <img src="${thumbnailUrl}" alt="${item.title}" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://img.youtube.com/vi/${item.url.includes('youtube.com') || item.url.includes('youtu.be') ? getYouTubeEmbedUrl(item.url)?.split('/').pop() : ''}/hqdefault.jpg';">
                ` : `
                  <div class="w-full h-48 flex items-center justify-center" style="background: linear-gradient(135deg, ${isGoogleDrive ? '#4285f4' : primaryColor}40, ${isGoogleDrive ? '#34a853' : primaryColor}80);">
                    <div class="text-center">
                      <div class="text-6xl mb-2">${isGoogleDrive ? 'üìÅ' : 'üìπ'}</div>
                      <div class="text-sm font-semibold px-4" style="color: ${textColor};">${isGoogleDrive ? 'Google Drive Video' : '‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠'}</div>
                    </div>
                  </div>
                `}
                <!-- Play Button Overlay -->
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-30 transition-all duration-300">
                  <div class="w-16 h-16 rounded-full ${isGoogleDrive ? 'bg-green-600' : 'bg-red-600'} flex items-center justify-center shadow-2xl transform hover:scale-110 transition-transform">
                    <svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                </div>
                <!-- Source Badge -->
                <div class="absolute bottom-2 right-2 bg-black bg-opacity-80 text-white text-xs px-2 py-1 rounded font-semibold">
                  ${isGoogleDrive ? 'üìÅ Google Drive' : 'üé¨ YouTube'}
                </div>
              </div>
              <div class="p-6">
                <h3 class="font-bold mb-2 line-clamp-2" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.2}px;">${item.title}</h3>
                <p class="line-clamp-2 mb-3" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.9}px;">${item.description}</p>
                <div class="flex items-center gap-2 text-xs" style="color: ${textColor}; opacity: 0.7;">
                  <span>üëÅÔ∏è ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ä‡∏°</span>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render documents
      const documentList = document.getElementById('document-list');
      const documentEmpty = document.getElementById('document-empty');
      const documents = allContent.filter(item => item.type === 'document');
      
      if (documents.length === 0) {
        documentList.innerHTML = '';
        documentEmpty.classList.remove('hidden');
        documentEmpty.style.color = textColor;
      } else {
        documentEmpty.classList.add('hidden');
        documentList.innerHTML = documents.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
          <div class="card-hover rounded-xl p-6 shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
            <div class="flex items-start gap-4">
              ${item.imageUrl ? `
                <img src="${item.imageUrl}" alt="${item.title}" class="w-24 h-24 rounded-lg object-cover flex-shrink-0" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              ` : `
                <div class="w-24 h-24 rounded-lg flex items-center justify-center text-4xl flex-shrink-0" style="background-color: ${primaryColor}20;">üìÑ</div>
              `}
              <div class="flex-1">
                <h3 class="font-bold mb-2" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.2}px;">${item.title}</h3>
                <p class="line-clamp-3" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.9}px;">${item.description}</p>
              </div>
            </div>
          </div>
        `;
        }).join('');
      }

      // Render mindmaps
      const mindmapList = document.getElementById('mindmap-list');
      const mindmapEmpty = document.getElementById('mindmap-empty');
      const mindmaps = allContent.filter(item => item.type === 'mindmap');
      
      if (mindmaps.length === 0) {
        mindmapList.innerHTML = '';
        mindmapEmpty.classList.remove('hidden');
        mindmapEmpty.style.color = textColor;
      } else {
        mindmapEmpty.classList.add('hidden');
        mindmapList.innerHTML = mindmaps.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
          <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
            ${item.imageUrl ? `
              <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-48 object-cover" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            ` : `
              <div class="w-full h-48 flex items-center justify-center text-6xl" style="background-color: ${primaryColor}20;">üó∫Ô∏è</div>
            `}
            <div class="p-6">
              <h3 class="font-bold mb-2" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.2}px;">${item.title}</h3>
              <p class="line-clamp-2" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.9}px;">${item.description}</p>
            </div>
          </div>
        `;
        }).join('');
      }

      // Render quizzes
      const quizList = document.getElementById('quiz-list');
      const quizEmpty = document.getElementById('quiz-empty');
      const quizzes = allContent.filter(item => item.type === 'quiz');
      
      if (quizzes.length === 0) {
        quizList.innerHTML = '';
        quizEmpty.classList.remove('hidden');
        quizEmpty.style.color = textColor;
      } else {
        quizEmpty.classList.add('hidden');
        quizList.innerHTML = quizzes.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
          <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
            ${item.imageUrl ? `
              <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-48 object-cover" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            ` : `
              <div class="w-full h-48 flex items-center justify-center" style="background: linear-gradient(135deg, ${primaryColor}40, ${primaryColor}80);">
                <div class="text-center">
                  <div class="text-6xl mb-2">üìù</div>
                  <div class="text-sm font-semibold px-4" style="color: ${textColor};">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</div>
                </div>
              </div>
            `}
            <div class="p-6">
              <h3 class="font-bold mb-2" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.2}px;">${item.title}</h3>
              <p class="line-clamp-2 mb-3" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.9}px;">${item.description}</p>
              <div class="flex items-center gap-2 text-xs" style="color: ${textColor}; opacity: 0.7;">
                <span>‚úèÔ∏è ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</span>
              </div>
            </div>
          </div>
        `;
        }).join('');
      }
    }

    function renderHomeContent(config, surfaceColor, textColor, primaryColor, customFont, baseSize, baseFontStack) {
      // Get featured content (max 3 items each)
      const featuredVideos = allContent.filter(item => item.type === 'video').slice(0, 3);
      const featuredDocs = allContent.filter(item => item.type === 'document').slice(0, 2);
      const featuredMindmaps = allContent.filter(item => item.type === 'mindmap').slice(0, 3);
      const featuredQuizzes = allContent.filter(item => item.type === 'quiz').slice(0, 3);

      // Render featured videos
      const homeVideoList = document.getElementById('home-video-list');
      if (featuredVideos.length === 0) {
        homeVideoList.innerHTML = `<div class="col-span-full text-center py-8 opacity-70" style="color: ${textColor};">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</div>`;
      } else {
        homeVideoList.innerHTML = featuredVideos.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          let thumbnailUrl = item.imageUrl;
          if (!thumbnailUrl && item.url) {
            thumbnailUrl = getVideoThumbnail(item.url);
          }
          
          const isGoogleDrive = item.url.includes('drive.google.com');
          
          return `
            <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
              <div class="relative">
                ${thumbnailUrl ? `
                  <img src="${thumbnailUrl}" alt="${item.title}" class="w-full h-48 object-cover" onerror="this.onerror=null; this.src='https://img.youtube.com/vi/${item.url.includes('youtube.com') || item.url.includes('youtu.be') ? getYouTubeEmbedUrl(item.url)?.split('/').pop() : ''}/hqdefault.jpg';">
                ` : `
                  <div class="w-full h-48 flex items-center justify-center" style="background: linear-gradient(135deg, ${isGoogleDrive ? '#4285f4' : primaryColor}40, ${isGoogleDrive ? '#34a853' : primaryColor}80);">
                    <div class="text-6xl">${isGoogleDrive ? 'üìÅ' : 'üìπ'}</div>
                  </div>
                `}
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-0 hover:bg-opacity-30 transition-all duration-300">
                  <div class="w-16 h-16 rounded-full ${isGoogleDrive ? 'bg-green-600' : 'bg-red-600'} flex items-center justify-center shadow-2xl transform hover:scale-110 transition-transform">
                    <svg class="w-8 h-8 text-white ml-1" fill="currentColor" viewBox="0 0 24 24">
                      <path d="M8 5v14l11-7z"/>
                    </svg>
                  </div>
                </div>
              </div>
              <div class="p-4">
                <h3 class="font-bold mb-1 line-clamp-2" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.1}px;">${item.title}</h3>
                <p class="line-clamp-2 text-sm" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">${item.description}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render featured documents
      const homeDocList = document.getElementById('home-document-list');
      if (featuredDocs.length === 0) {
        homeDocList.innerHTML = `<div class="col-span-full text-center py-8 opacity-70" style="color: ${textColor};">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</div>`;
      } else {
        homeDocList.innerHTML = featuredDocs.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
            <div class="card-hover rounded-xl p-4 shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
              <div class="flex items-start gap-3">
                ${item.imageUrl ? `
                  <img src="${item.imageUrl}" alt="${item.title}" class="w-20 h-20 rounded-lg object-cover flex-shrink-0" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                ` : `
                  <div class="w-20 h-20 rounded-lg flex items-center justify-center text-3xl flex-shrink-0" style="background-color: ${primaryColor}20;">üìÑ</div>
                `}
                <div class="flex-1">
                  <h3 class="font-bold mb-1" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.1}px;">${item.title}</h3>
                  <p class="line-clamp-2 text-sm" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">${item.description}</p>
                </div>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render featured mindmaps
      const homeMindmapList = document.getElementById('home-mindmap-list');
      if (featuredMindmaps.length === 0) {
        homeMindmapList.innerHTML = `<div class="col-span-full text-center py-8 opacity-70" style="color: ${textColor};">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û</div>`;
      } else {
        homeMindmapList.innerHTML = featuredMindmaps.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
            <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
              ${item.imageUrl ? `
                <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-40 object-cover" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              ` : `
                <div class="w-full h-40 flex items-center justify-center text-5xl" style="background-color: ${primaryColor}20;">üó∫Ô∏è</div>
              `}
              <div class="p-4">
                <h3 class="font-bold mb-1" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.1}px;">${item.title}</h3>
                <p class="line-clamp-2 text-sm" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">${item.description}</p>
              </div>
            </div>
          `;
        }).join('');
      }

      // Render featured quizzes
      const homeQuizList = document.getElementById('home-quiz-list');
      if (featuredQuizzes.length === 0) {
        homeQuizList.innerHTML = `<div class="col-span-full text-center py-8 opacity-70" style="color: ${textColor};">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</div>`;
      } else {
        homeQuizList.innerHTML = featuredQuizzes.map(item => {
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
            <div class="card-hover rounded-xl overflow-hidden shadow-lg cursor-pointer" style="background-color: ${surfaceColor};" onclick="viewContent('${itemId}')">
              ${item.imageUrl ? `
                <img src="${item.imageUrl}" alt="${item.title}" class="w-full h-40 object-cover" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
              ` : `
                <div class="w-full h-40 flex items-center justify-center" style="background: linear-gradient(135deg, ${primaryColor}40, ${primaryColor}80);">
                  <div class="text-5xl">üìù</div>
                </div>
              `}
              <div class="p-4">
                <h3 class="font-bold mb-1" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 1.1}px;">${item.title}</h3>
                <p class="line-clamp-2 text-sm" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">${item.description}</p>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    function renderAdminList() {
      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const surfaceColor = config.surface_color || defaultConfig.surface_color;
      const backgroundColor = config.background_color || defaultConfig.background_color;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';

      const adminList = document.getElementById('admin-content-list');
      const adminEmpty = document.getElementById('admin-empty');
      const contentCount = document.getElementById('content-count');

      // Update count
      if (contentCount) {
        contentCount.textContent = `‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${allContent.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
        contentCount.style.color = textColor;
        contentCount.style.fontFamily = `${customFont}, ${baseFontStack}`;
      }

      if (allContent.length === 0) {
        adminList.innerHTML = '';
        adminEmpty.classList.remove('hidden');
        adminEmpty.style.color = textColor;
      } else {
        adminEmpty.classList.add('hidden');
        adminList.innerHTML = allContent.map(item => {
          const typeIcon = item.type === 'video' ? 'üìπ' : item.type === 'document' ? 'üìÑ' : item.type === 'mindmap' ? 'üó∫Ô∏è' : 'üìù';
          const typeName = item.type === 'video' ? '‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠' : item.type === 'document' ? '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£' : item.type === 'mindmap' ? '‡∏°‡∏≤‡∏¢‡πÅ‡∏°‡∏û' : '‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
          const itemId = item.firebaseId || item.__backendId || item.id;
          return `
            <div class="rounded-xl p-4 shadow-md hover:shadow-lg transition-all border-2 hover:scale-[1.02] bg-white" style="border-color: #dbeafe;">
              <div class="flex items-start justify-between gap-3">
                <div class="flex-1">
                  <div class="flex items-center gap-2 mb-2">
                    <span class="text-2xl">${typeIcon}</span>
                    <div class="flex-1">
                      <div class="font-bold text-sm text-blue-900" style="font-family: ${customFont}, ${baseFontStack};">${item.title}</div>
                      <div class="text-xs mt-1" style="font-family: ${customFont}, ${baseFontStack};">
                        <span class="inline-block px-2 py-0.5 rounded-full text-xs font-semibold bg-blue-100 text-blue-700">${typeName}</span>
                      </div>
                    </div>
                  </div>
                  <p class="text-xs text-gray-600 line-clamp-2 mt-2" style="font-family: ${customFont}, ${baseFontStack};">${item.description}</p>
                </div>
                <button onclick="deleteContent('${itemId}')" class="px-4 py-2 rounded-lg text-xs font-bold hover:scale-110 transition-transform shadow-md hover:shadow-lg flex-shrink-0 bg-gradient-to-r from-red-500 to-red-600 text-white" style="font-family: ${customFont}, ${baseFontStack};">
                  üóëÔ∏è
                </button>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    function switchSection(sectionName) {
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.add('hidden');
      });

      document.querySelectorAll('.nav-btn').forEach(btn => {
        btn.classList.remove('active');
        btn.style.backgroundColor = 'rgba(255, 255, 255, 0.1)';
        btn.style.borderColor = 'rgba(255, 255, 255, 0.2)';
      });

      document.getElementById(`section-${sectionName}`).classList.remove('hidden');

      const activeBtn = document.getElementById(`btn-${sectionName}`);
      activeBtn.classList.add('active');
      activeBtn.style.backgroundColor = 'rgba(255, 255, 255, 0.2)';
      activeBtn.style.borderColor = 'rgba(255, 255, 255, 0.3)';

      currentSection = sectionName;
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = 'toast';
      toast.style.backgroundColor = type === 'success' ? '#10b981' : '#ef4444';
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.remove();
      }, 3000);
    }

    async function deleteContent(itemId) {
      const item = allContent.find(c => 
        c.firebaseId === itemId || c.__backendId === itemId || c.id === itemId
      );
      if (!item) return;

      // Use Firebase if available
      if (item.firebaseId) {
        const success = await deleteContentFromFirebase(item.firebaseId);
        if (success) {
          showToast('‡∏•‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
        }
      } else if (window.dataSdk && item.__backendId) {
        const result = await window.dataSdk.delete(item);
        if (result.isOk) {
          showToast('‡∏•‡∏ö‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        } else {
          showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö', 'error');
        }
      }
    }

    function viewContent(itemId) {
      const item = allContent.find(c => 
        c.firebaseId === itemId || c.__backendId === itemId || c.id === itemId
      );
      if (!item) return;

      const config = window.elementSdk ? window.elementSdk.config : defaultConfig;
      const textColor = config.text_color || defaultConfig.text_color;
      const primaryColor = config.primary_color || defaultConfig.primary_color;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseSize = config.font_size || defaultConfig.font_size;
      const baseFontStack = 'system-ui, -apple-system, sans-serif';

      const viewTitle = document.getElementById('view-title');
      viewTitle.textContent = item.title;
      viewTitle.style.color = primaryColor;
      viewTitle.style.fontFamily = `${customFont}, ${baseFontStack}`;
      viewTitle.style.fontSize = `${baseSize * 1.8}px`;

      const viewContent = document.getElementById('view-content');
      
      if (item.type === 'video') {
        const youtubeEmbed = getYouTubeEmbedUrl(item.url);
        const driveEmbed = getGoogleDriveVideoEmbedUrl(item.url);
        const embedUrl = youtubeEmbed || driveEmbed;
        const isGoogleDrive = item.url.includes('drive.google.com');
        
        if (embedUrl) {
          viewContent.innerHTML = `
            <div class="space-y-6">
              <div class="video-container rounded-xl overflow-hidden shadow-2xl">
                <iframe src="${embedUrl}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
              </div>
              <div class="p-6 rounded-xl" style="background-color: ${config.background_color || defaultConfig.background_color};">
                <h4 class="font-bold mb-2 text-lg" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ô‡∏µ‡πâ</h4>
                <p class="mb-4" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">${item.description}</p>
                <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="inline-block px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-transform" style="background-color: ${primaryColor}; color: white; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize * 0.9}px;">
                  ${isGoogleDrive ? 'üìÅ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Drive' : 'üîó ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô YouTube'}
                </a>
              </div>
            </div>
          `;
        } else {
          viewContent.innerHTML = `
            <div class="space-y-6">
              <div class="rounded-xl p-12 text-center" style="background: linear-gradient(135deg, ${primaryColor}20, ${primaryColor}40);">
                <div class="text-8xl mb-4">üé¨</div>
                <h3 class="text-2xl font-bold mb-4" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏•‡πâ‡∏ß!</h3>
                <p class="mb-6 text-lg" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠</p>
                <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="inline-block px-8 py-4 rounded-lg font-bold text-lg hover:scale-105 transition-transform shadow-lg" style="background-color: ${primaryColor}; color: white; font-family: ${customFont}, ${baseFontStack};">
                  ‚ñ∂Ô∏è ‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                </a>
              </div>
              <div class="p-6 rounded-xl" style="background-color: ${config.background_color || defaultConfig.background_color};">
                <h4 class="font-bold mb-2 text-lg" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏ô‡∏µ‡πâ</h4>
                <p style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">${item.description}</p>
              </div>
            </div>
          `;
        }
      } else if (item.type === 'document') {
        // Check if URL is a PDF or Google Drive document
        const isPDF = item.url.toLowerCase().endsWith('.pdf') || item.url.includes('drive.google.com');
        const isGoogleDocs = item.url.includes('docs.google.com');
        
        let embedUrl = item.url;
        if (item.url.includes('drive.google.com/file/d/')) {
          // Convert Google Drive link to embed format
          const fileId = item.url.match(/\/d\/([^/]+)/)?.[1];
          if (fileId) {
            embedUrl = `https://drive.google.com/file/d/${fileId}/preview`;
          }
        } else if (isGoogleDocs && !item.url.includes('/preview')) {
          // Convert Google Docs to preview mode
          embedUrl = item.url.replace('/edit', '/preview');
        }
        
        viewContent.innerHTML = `
          <div class="space-y-6">
            ${isPDF || isGoogleDocs ? `
              <div class="rounded-xl overflow-hidden shadow-2xl" style="height: 600px;">
                <iframe src="${embedUrl}" class="w-full h-full border-0" allow="autoplay"></iframe>
              </div>
            ` : item.imageUrl ? `
              <img src="${item.imageUrl}" alt="${item.title}" class="w-full rounded-xl shadow-lg" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            ` : `
              <div class="rounded-xl p-12 text-center" style="background: linear-gradient(135deg, ${primaryColor}20, ${primaryColor}40);">
                <div class="text-8xl mb-4">üìÑ</div>
                <h3 class="text-2xl font-bold mb-4" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏≠‡πà‡∏≤‡∏ô!</h3>
                <p class="mb-6 text-lg" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</p>
              </div>
            `}
            <div class="p-6 rounded-xl" style="background-color: ${config.background_color || defaultConfig.background_color};">
              <h4 class="font-bold mb-2 text-lg" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ</h4>
              <p class="mb-4" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">${item.description}</p>
              <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="inline-block px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-transform shadow-lg" style="background-color: ${primaryColor}; color: white; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">üîó ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà</a>
            </div>
          </div>
        `;
      } else {
        // For mindmap and quiz
        viewContent.innerHTML = `
          <div class="space-y-6">
            ${item.imageUrl ? `
              <img src="${item.imageUrl}" alt="${item.title}" class="w-full rounded-xl shadow-lg" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
            ` : `
              <div class="rounded-xl p-12 text-center" style="background: linear-gradient(135deg, ${primaryColor}20, ${primaryColor}40);">
                <div class="text-8xl mb-4">${item.type === 'mindmap' ? 'üó∫Ô∏è' : 'üìù'}</div>
                <h3 class="text-2xl font-bold mb-4" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß!</h3>
                <p class="mb-6 text-lg" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack};">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î</p>
              </div>
            `}
            <div class="p-6 rounded-xl" style="background-color: ${config.background_color || defaultConfig.background_color};">
              <h4 class="font-bold mb-2 text-lg" style="color: ${primaryColor}; font-family: ${customFont}, ${baseFontStack};">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h4>
              <p class="mb-4" style="color: ${textColor}; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">${item.description}</p>
              <a href="${item.url}" target="_blank" rel="noopener noreferrer" class="inline-block px-6 py-3 rounded-lg font-semibold hover:scale-105 transition-transform shadow-lg" style="background-color: ${primaryColor}; color: white; font-family: ${customFont}, ${baseFontStack}; font-size: ${baseSize}px;">üîó ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå</a>
            </div>
          </div>
        `;
      }

      document.getElementById('view-modal').classList.remove('hidden');
    }

    // Event Listeners
    document.getElementById('login-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const loginBtn = document.getElementById('btn-login');
      const loginText = document.getElementById('login-text');
      const loginSpinner = document.getElementById('login-spinner');
      
      loginBtn.disabled = true;
      loginText.classList.add('hidden');
      loginSpinner.classList.remove('hidden');
      
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      await handleLogin(email, password);
      
      loginBtn.disabled = false;
      loginText.classList.remove('hidden');
      loginSpinner.classList.add('hidden');
    });

    document.getElementById('register-form').addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const registerBtn = document.getElementById('btn-register');
      const registerText = document.getElementById('register-text');
      const registerSpinner = document.getElementById('register-spinner');
      
      registerBtn.disabled = true;
      registerText.classList.add('hidden');
      registerSpinner.classList.remove('hidden');
      
      const email = document.getElementById('register-email').value;
      const password = document.getElementById('register-password').value;
      const confirmPassword = document.getElementById('register-confirm').value;
      
      const success = await handleRegister(email, password, confirmPassword);
      
      if (success) {
        // Switch to login form
        document.getElementById('register-form').classList.add('hidden');
        document.getElementById('login-form').classList.remove('hidden');
      }
      
      registerBtn.disabled = false;
      registerText.classList.remove('hidden');
      registerSpinner.classList.add('hidden');
    });

    document.getElementById('btn-toggle-register').addEventListener('click', () => {
      document.getElementById('login-form').classList.add('hidden');
      document.getElementById('register-form').classList.remove('hidden');
      document.getElementById('login-error').classList.add('hidden');
      document.getElementById('register-error').classList.add('hidden');
    });

    document.getElementById('btn-toggle-login').addEventListener('click', () => {
      document.getElementById('register-form').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
      document.getElementById('login-error').classList.add('hidden');
      document.getElementById('register-error').classList.add('hidden');
    });

    document.getElementById('btn-logout').addEventListener('click', () => {
      handleLogout();
    });

    document.getElementById('btn-home').addEventListener('click', () => switchSection('home'));
    document.getElementById('btn-video').addEventListener('click', () => switchSection('video'));
    document.getElementById('btn-document').addEventListener('click', () => switchSection('document'));
    document.getElementById('btn-mindmap').addEventListener('click', () => switchSection('mindmap'));
    document.getElementById('btn-quiz').addEventListener('click', () => switchSection('quiz'));

    document.getElementById('btn-admin').addEventListener('click', async () => {
      // Check if user is logged in with Firebase
      if (currentUser) {
        // Check if user is admin
        if (db) {
          try {
            const adminDoc = await db.collection('admins').doc(currentUser.uid).get();
            if (adminDoc.exists) {
              // User is admin, open admin panel
              document.getElementById('admin-modal').classList.remove('hidden');
              loadPendingUsers();
            } else {
              // User is not admin
              showToast('‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', 'error');
            }
          } catch (error) {
            console.error('Error checking admin status:', error);
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå', 'error');
          }
        }
      } else {
        // User not logged in, show message
        showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£', 'error');
      }
    });

    document.getElementById('tab-content').addEventListener('click', () => {
      // Switch to content tab
      document.getElementById('content-tab').classList.remove('hidden');
      document.getElementById('users-tab').classList.add('hidden');
      
      // Update tab styles
      document.getElementById('tab-content').classList.remove('border-transparent', 'text-gray-500');
      document.getElementById('tab-content').classList.add('border-purple-500', 'text-purple-600');
      document.getElementById('tab-users').classList.remove('border-purple-500', 'text-purple-600');
      document.getElementById('tab-users').classList.add('border-transparent', 'text-gray-500');
    });

    document.getElementById('tab-users').addEventListener('click', () => {
      // Switch to users tab
      document.getElementById('content-tab').classList.add('hidden');
      document.getElementById('users-tab').classList.remove('hidden');
      
      // Update tab styles
      document.getElementById('tab-users').classList.remove('border-transparent', 'text-gray-500');
      document.getElementById('tab-users').classList.add('border-purple-500', 'text-purple-600');
      document.getElementById('tab-content').classList.remove('border-purple-500', 'text-purple-600');
      document.getElementById('tab-content').classList.add('border-transparent', 'text-gray-500');
      
      // Load pending users
      if (db) {
        loadPendingUsers();
      }
    });

    document.getElementById('btn-close-modal').addEventListener('click', () => {
      document.getElementById('admin-modal').classList.add('hidden');
    });

    document.getElementById('modal-backdrop').addEventListener('click', () => {
      document.getElementById('admin-modal').classList.add('hidden');
    });

    document.getElementById('btn-close-view').addEventListener('click', () => {
      document.getElementById('view-modal').classList.add('hidden');
    });

    document.getElementById('view-backdrop').addEventListener('click', () => {
      document.getElementById('view-modal').classList.add('hidden');
    });

    document.getElementById('add-content-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (allContent.length >= 999) {
        showToast('‡∏ñ‡∏∂‡∏á‡∏Ç‡∏µ‡∏î‡∏à‡∏≥‡∏Å‡∏±‡∏î 999 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô', 'error');
        return;
      }

      const submitBtn = document.getElementById('btn-submit');
      const submitText = document.getElementById('submit-text');
      const submitSpinner = document.getElementById('submit-spinner');

      submitBtn.disabled = true;
      submitText.classList.add('hidden');
      submitSpinner.classList.remove('hidden');

      try {
        const newContent = {
          id: Date.now().toString(),
          type: document.getElementById('content-type').value,
          title: document.getElementById('content-title').value,
          description: document.getElementById('content-description').value,
          url: document.getElementById('content-url').value,
          imageUrl: document.getElementById('content-image').value || ''
        };

        // Try Firebase first
        if (db) {
          const success = await addContentToFirebase(newContent);
          if (success) {
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÉ‡∏ô Firebase)', 'success');
            document.getElementById('add-content-form').reset();
          } else {
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å Firebase', 'error');
          }
        } else if (window.dataSdk) {
          // Fallback to Data SDK
          newContent.createdAt = new Date().toISOString();
          const result = await window.dataSdk.create(newContent);

          if (result.isOk) {
            showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
            document.getElementById('add-content-form').reset();
          } else {
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + (result.error.message || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà'), 'error');
          }
        } else {
          showToast('‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏û‡∏£‡πâ‡∏≠‡∏° ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà', 'error');
        }
      } catch (error) {
        showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
        console.error('Error adding content:', error);
      } finally {
        submitBtn.disabled = false;
        submitText.classList.remove('hidden');
        submitSpinner.classList.add('hidden');
      }
    });

    window.viewContent = viewContent;
    window.deleteContent = deleteContent;

    // Initialize
    async function init() {
      // Listen for auth state changes
      if (auth) {
        auth.onAuthStateChanged((user) => {
          if (user) {
            // User is signed in
            showMainApp(user);
            
            // Initialize Firebase listener
            if (db) {
              loadContentFromFirebase();
            }
          } else {
            // User is signed out
            showLoginScreen();
            
            // Unsubscribe from Firestore if needed
            if (unsubscribeFirestore) {
              unsubscribeFirestore();
              unsubscribeFirestore = null;
            }
          }
        });
      }

      // Fallback to Data SDK if Firebase is not available
      if (!db && window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          console.error('Failed to initialize Data SDK');
        }
      }

      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
    }

    // Cleanup on page unload
    window.addEventListener('beforeunload', () => {
      if (unsubscribeFirestore) {
        unsubscribeFirestore();
      }
      if (unsubscribePendingUsers) {
        unsubscribePendingUsers();
      }
    });

    init();
  </script>
  </div>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99c6fe21351445b7',t:'MTc2Mjc5MjgzOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
